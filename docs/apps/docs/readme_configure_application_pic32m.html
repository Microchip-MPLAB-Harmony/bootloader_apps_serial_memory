<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Application Configurations for MIPS based MCUs | Microchip MPLAB Harmony SERIAL MEMORY Bootloader Applications help</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Application Configurations for MIPS based MCUs" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 SERIAL MEMORY Bootloader Applications package" /> <meta property="og:description" content="Harmony 3 SERIAL MEMORY Bootloader Applications package" /> <link rel="canonical" href="../../apps/docs/readme_configure_application_pic32m.html" /> <meta property="og:url" content="../../apps/docs/readme_configure_application_pic32m.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony SERIAL MEMORY Bootloader Applications help" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Application Configurations for MIPS based MCUs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Harmony 3 SERIAL MEMORY Bootloader Applications package","headline":"Application Configurations for MIPS based MCUs","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"../../apps/docs/readme_configure_application_pic32m.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../index.html" class="nav-list-link">Serial Memory Bootloader Applications</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/i2c_eeprom_bootloader/readme.html" class="nav-list-link">I2C EEPROM Bootloader</a></li><li class="nav-list-item "><a href="../../apps/spi_eeprom_bootloader/readme.html" class="nav-list-link">SPI EEPROM Bootloader</a></li><li class="nav-list-item "><a href="../../apps/spi_flash_bootloader/readme.html" class="nav-list-link">SPI Flash Bootloader</a></li><li class="nav-list-item "><a href="../../apps/qspi_flash_bootloader/readme.html" class="nav-list-link">QSPI Flash Bootloader</a></li><li class="nav-list-item "><a href="../../apps/fs/spi/readme.html" class="nav-list-link">FS SPI Flash Bootloader</a></li><li class="nav-list-item "><a href="../../apps/fs/qspi/readme.html" class="nav-list-link">FS QSPI Flash Bootloader</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../tools/readme.html" class="nav-list-link">Serial Memory Bootloader Host Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="../../tools/docs/readme_uart_host.html" class="nav-list-link">UART Host Script</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../apps/docs/readme_configure_application.html" class="nav-list-link">Application Configurations</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/docs/readme_configure_application_sam.html" class="nav-list-link">Application Configurations for CORTEX-M based MCUs</a></li><li class="nav-list-item active"><a href="../../apps/docs/readme_configure_application_pic32m.html" class="nav-list-link active">Application Configurations for MIPS based MCUs</a></li></ul></li><li class="nav-list-item"><a href="../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony SERIAL MEMORY Bootloader Applications help" aria-label="Search Microchip MPLAB Harmony SERIAL MEMORY Bootloader Applications help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../apps/docs/readme_configure_application.html">Application Configurations</a></li> <li class="breadcrumb-nav-list-item"><span>Application Configurations for MIPS based MCUs</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="configuring-an-application-to-be-bootloaded-for-mips-based-mcus"> <a href="#configuring-an-application-to-be-bootloaded-for-mips-based-mcus" aria-labelledby="configuring-an-application-to-be-bootloaded-for-mips-based-mcus" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring an application to be bootloaded for MIPS based MCUs </h1> <h2 id="linker-configurations-for-the-application-to-be-bootloaded"> <a href="#linker-configurations-for-the-application-to-be-bootloaded" aria-labelledby="linker-configurations-for-the-application-to-be-bootloaded" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Linker configurations for the application to be bootloaded </h2> <h3 id="bootloader-placement-for-various-pic32m-product-families"> <a href="#bootloader-placement-for-various-pic32m-product-families" aria-labelledby="bootloader-placement-for-various-pic32m-product-families" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bootloader placement for various PIC32M product families </h3> <p>The bootloader is placed in <strong>Boot Flash Memory (BFM)</strong> or <strong>Program Flash Memory (PFM)</strong> based on the size of the bootloader and available Boot flash memory on the device.</p> <ul> <li> <p>If the bootloader fits into the available BFM, it is placed in BFM. The user application can use the complete area of the program Flash memory.</p> </li> <li> <p>If the bootloader does not fit into the available BFM, it is placed in PFM. The user application can use the remaining area of the program Flash memory.</p> </li> <li> <p>The following table shows the available Boot Flash memory and the placement of different bootloaders by product family.</p> <p align="center"> <img src="./images/bootloader_placement.png" /> </p> </li> </ul> <h2 id="setting-up-the-application-linker-script"> <a href="#setting-up-the-application-linker-script" aria-labelledby="setting-up-the-application-linker-script" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up the Application linker script </h2> <p>The linker script file of the application project has to be modified to place the vector table and reset handlers in program flash memory.</p> <ul> <li> <p>For Quick start, Refer to pre developed application linker scripts <strong>app_XX.ld</strong> placed in projects device specific configuration folder of <strong>bootloader_apps_xxx/</strong> repository</p> </li> <li> <p>Reset Address for the application to be loaded through bootloader should match the Application start address mentioned in bootloader project.</p> </li> <li> <p>The vector address of a given interrupt is calculated using Exception Base (EBASE) CPU register and the _ebase_address should be aligned to 4KB boundary</p> </li> <li> <p><strong>Note: The below sections provides overview of changes required in the applications linker scripts. The address location and size may vary based on the specific device used</strong></p> </li> </ul> <h3 id="for-bootloaders-placed-in-boot-flash-memory-pic32mz-and-pic32mk-devices"> <a href="#for-bootloaders-placed-in-boot-flash-memory-pic32mz-and-pic32mk-devices" aria-labelledby="for-bootloaders-placed-in-boot-flash-memory-pic32mz-and-pic32mk-devices" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> For Bootloaders placed in Boot Flash Memory (PIC32MZ and PIC32MK Devices) </h3> <ul> <li>The application start address by default will be start of program flash memory <ul> <li><strong>Refer to specific device datasheet for program flash memory start address and length</strong></li> </ul> </li> <li> <p>The Initial 4KB from Application start address are used by Reset Handler and and cache_init section</p> </li> <li> <p>XC32 Compiler calculates offset from the EBASE address and initializes the value of interrupt vector offset (OFFx) register. The offset register is combined with EBASE register using a bitwise OR operator to obtain the interrupt vector address that the CPU will jump to when the corresponding interrupt occurs.</p> </li> <li>If the EBASE address is aligned to 4KB, then all the interrupt vectors must be located within the 4KB from base address. <ul> <li><strong>Example:</strong> When _ebase_address is set to <strong>0x9D001000</strong> and interrupts vectors are not located withing the 4KB boundary from the ebase address <strong>(OFFx &gt; 0x1000)</strong>, then the bitwise OR operator may not provide correct interrupt vector address.</li> </ul> </li> <li>To provide maximum flexibility in placement of interrupt vectors: <ul> <li> <p>Always place the <strong>_ebase_address</strong> at start of Program flash memory <strong>(Example : 0x9D000000)</strong> like the default linker script</p> </li> <li> <p>Change the offsets of exceptions and vector section to place them after the device startup code. With this the interrupt handlers can be located anywhere in the Program Flash memory.</p> </li> </ul> </li> <li>Updated linker scripts as explained above is shown here <strong>as an example</strong> <ul> <li><strong>Note: Cache related sections are not applicable for PIC32MK Devices</strong></li> </ul> </li> </ul> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PROVIDE</span><span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">);</span>
<span class="n">PROVIDE</span><span class="p">(</span><span class="n">_ebase_address</span> <span class="o">=</span> <span class="mh">0x9D000000</span><span class="p">);</span>

<span class="cm">/* Place the vector table and other exceptions after the device reset and
 * cache init code.
 */</span>
<span class="n">PROVIDE</span><span class="p">(</span><span class="n">_ebase_vector_offsets</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">);</span>

<span class="n">_RESET_ADDR</span>                    <span class="o">=</span> <span class="mh">0xBD000000</span><span class="p">;</span>
<span class="n">_SIMPLE_TLB_REFILL_EXCPT_ADDR</span>  <span class="o">=</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">_CACHE_ERR_EXCPT_ADDR</span>          <span class="o">=</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="n">_GEN_EXCPT_ADDR</span>                <span class="o">=</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mh">0x180</span><span class="p">;</span>

<span class="n">kseg0_program_mem</span>  <span class="p">(</span><span class="n">rx</span><span class="p">)</span> <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x9D001000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x200000</span> <span class="o">-</span> <span class="mh">0x1000</span>

<span class="n">kseg1_boot_mem</span>          <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0xBD000000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x480</span>

<span class="n">kseg1_boot_mem_4B0</span>      <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0xBD0004B0</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x1000</span> <span class="o">-</span> <span class="mh">0x4B0</span>

<span class="cm">/* Boot Sections */</span>
<span class="p">.</span><span class="n">reset</span> <span class="n">_RESET_ADDR</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">))</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">.</span><span class="n">startup</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg1_boot_mem</span>

<span class="p">.</span><span class="n">cache_init</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="o">*</span><span class="p">(.</span><span class="n">cache_init</span><span class="p">)</span>
  <span class="o">*</span><span class="p">(.</span><span class="n">cache_init</span><span class="p">.</span><span class="o">*</span><span class="p">)</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg1_boot_mem_4B0</span>
<span class="p">...</span>

<span class="cm">/* Interrupt vector table with vector offsets */</span>
<span class="p">.</span><span class="n">vectors</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mh">0x200</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="cm">/*  Symbol __vector_offset_n points to .vector_n if it exists,
   *  otherwise points to the default handler. The
   *  vector_offset_init.o module then provides a .data section
   *  containing values used to initialize the vector-offset SFRs
   *  in the crt0 startup code.
   */</span>
  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">__vector_offset_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEFINED</span><span class="p">(</span><span class="n">__vector_dispatch_0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(.</span> <span class="o">-</span> <span class="n">_ebase_address</span><span class="p">)</span> <span class="o">:</span> <span class="n">__vector_offset_default</span><span class="p">);</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_0</span><span class="p">))</span>
  <span class="p">...</span>
  <span class="p">...</span>
  <span class="cm">/* Default interrupt handler */</span>
  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">__vector_offset_default</span> <span class="o">=</span> <span class="p">.</span> <span class="o">-</span> <span class="n">_ebase_address</span><span class="p">;</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_default</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg0_program_mem</span>

</code></pre></div></div> <h3 id="for-bootloaders-placed-in-program-flash-memory-pic32mk-devices"> <a href="#for-bootloaders-placed-in-program-flash-memory-pic32mk-devices" aria-labelledby="for-bootloaders-placed-in-program-flash-memory-pic32mk-devices" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> For Bootloaders placed in Program Flash Memory (PIC32MK Devices) </h3> <ul> <li>The bootloader code resides from start of Program flash memory, hence the application start address has to be after the end of bootloader. <ul> <li><strong>Refer to specific device datasheet for program flash memory start address and length</strong></li> </ul> </li> <li> <p>The Initial 4KB from Application start address are used by Reset Handler section</p> </li> <li> <p>XC32 Compiler calculates offset from the EBASE address and initializes the value of interrupt vector offset (OFFx) register. The offset register is combined with EBASE register using a bitwise OR operator to obtain the interrupt vector address that the CPU will jump to when the corresponding interrupt occurs.</p> </li> <li>If the EBASE address is aligned to 4KB, then all the interrupt vectors must be located within the 4KB from base address. <ul> <li><strong>Example:</strong> When _ebase_address is set to <strong>0x9D001000</strong> and interrupts vectors are not located withing the 4KB boundary from the ebase address <strong>(OFFx &gt; 0x1000)</strong>, then the bitwise OR operator may not provide correct interrupt vector address.</li> </ul> </li> <li>To provide maximum flexibility in placement of interrupt vectors: <ul> <li> <p>Always place the <strong>_ebase_address</strong> at start of Program flash memory <strong>(Example : 0x9D000000)</strong> like the default linker script</p> </li> <li> <p><strong>Note: As _ebase_address is only used to calculate the vector offset it can be placed at start of program flash memory even though the bootloader code is residing there</strong></p> </li> <li> <p>Change the offsets of exceptions and vector section to place them <strong>after the device startup code of application</strong>. With this the interrupt handlers can be located anywhere in the Program Flash memory after bootloader space</p> </li> </ul> </li> <li>Updated linked scripts as explained above is shown here <strong>as an example</strong>. <ul> <li>Bootloader length <strong>&lt;bootloader_length&gt;</strong> in the below snippet needs to be replaced with size of the respective bootloader.</li> </ul> </li> </ul> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PROVIDE</span><span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">);</span>
<span class="n">PROVIDE</span><span class="p">(</span><span class="n">_ebase_address</span> <span class="o">=</span> <span class="mh">0x9D000000</span><span class="p">);</span>

<span class="cm">/* Place the vector table and other exceptions after the device reset and
 * cache init code.
 */</span>
<span class="n">PROVIDE</span><span class="p">(</span><span class="n">_ebase_vector_offsets</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">);</span>

<span class="n">_RESET_ADDR</span>                    <span class="o">=</span> <span class="mh">0xBD000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">_SIMPLE_TLB_REFILL_EXCPT_ADDR</span>  <span class="o">=</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">_GEN_EXCPT_ADDR</span>                <span class="o">=</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mh">0x180</span><span class="p">;</span>

<span class="n">kseg0_program_mem</span>  <span class="p">(</span><span class="n">rx</span><span class="p">)</span> <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x9D000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x200000</span> <span class="o">-</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">-</span> <span class="mh">0x1000</span>

<span class="n">kseg1_boot_mem</span>          <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0xBD000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x1000</span>

<span class="cm">/* Boot Sections */</span>
<span class="p">.</span><span class="n">reset</span> <span class="n">_RESET_ADDR</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">))</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">.</span><span class="n">startup</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg1_boot_mem</span>

<span class="p">...</span>

<span class="cm">/* Interrupt vector table with vector offsets */</span>
<span class="p">.</span><span class="n">vectors</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="n">_ebase_vector_offsets</span> <span class="o">+</span> <span class="mh">0x200</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="cm">/*  Symbol __vector_offset_n points to .vector_n if it exists,
   *  otherwise points to the default handler. The
   *  vector_offset_init.o module then provides a .data section
   *  containing values used to initialize the vector-offset SFRs
   *  in the crt0 startup code.
   */</span>
  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">__vector_offset_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEFINED</span><span class="p">(</span><span class="n">__vector_dispatch_0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(.</span> <span class="o">-</span> <span class="n">_ebase_address</span><span class="p">)</span> <span class="o">:</span> <span class="n">__vector_offset_default</span><span class="p">);</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_0</span><span class="p">))</span>
  <span class="p">...</span>
  <span class="p">...</span>
  <span class="cm">/* Default interrupt handler */</span>
  <span class="p">.</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">__vector_offset_default</span> <span class="o">=</span> <span class="p">.</span> <span class="o">-</span> <span class="n">_ebase_address</span><span class="p">;</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_default</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg0_program_mem</span>

</code></pre></div></div> <h3 id="for-bootloaders-placed-in-program-flash-memory-pic32mx-devices"> <a href="#for-bootloaders-placed-in-program-flash-memory-pic32mx-devices" aria-labelledby="for-bootloaders-placed-in-program-flash-memory-pic32mx-devices" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> For Bootloaders placed in Program Flash Memory (PIC32MX Devices) </h3> <ul> <li> <p>The bootloader code resides from start of Program flash memory, hence the application start address has to be after the end of bootloader.</p> </li> <li> <p>The Initial 4KB from Application start address are used by Reset Handler section</p> </li> <li> <p>Place the _ebase_address <strong>after the device startup code of application</strong></p> </li> <li> <p>Updated linked scripts as explained above is shown here <strong>as an example.</strong></p> <ul> <li>Bootloader length <strong>&lt;bootloader_length&gt;</strong> in the below snippet needs to be replaced with size of the respective bootloader.</li> </ul> </li> </ul> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PROVIDE</span><span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">);</span>
<span class="n">PROVIDE</span><span class="p">(</span><span class="n">_ebase_address</span> <span class="o">=</span> <span class="mh">0x9D000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">);</span>

<span class="n">_RESET_ADDR</span>                 <span class="o">=</span> <span class="mh">0xBD000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">kseg0_program_mem</span>     <span class="p">(</span><span class="n">rx</span><span class="p">)</span>  <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x9D000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x80000</span> <span class="o">-</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span> <span class="o">-</span> <span class="mh">0x1000</span>
<span class="n">kseg1_boot_mem</span>              <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0xBD000000</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">bootloader_length</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mh">0x1000</span>

<span class="cm">/* Boot Sections */</span>
<span class="p">.</span><span class="n">reset</span> <span class="n">_RESET_ADDR</span> <span class="o">:</span>
<span class="p">{</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">))</span>
  <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">reset</span><span class="p">.</span><span class="n">startup</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg1_boot_mem</span>
<span class="p">...</span>

<span class="p">.</span><span class="n">vector_0</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="mh">0x200</span> <span class="o">+</span> <span class="p">((</span><span class="n">_vector_spacing</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span>
<span class="p">{</span>
   <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_0</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg0_program_mem</span>
<span class="n">ASSERT</span> <span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">SIZEOF</span><span class="p">(.</span><span class="n">vector_0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="s">"function at exception vector 0 too large"</span><span class="p">)</span>

<span class="p">.</span><span class="n">vector_1</span> <span class="n">_ebase_address</span> <span class="o">+</span> <span class="mh">0x200</span> <span class="o">+</span> <span class="p">((</span><span class="n">_vector_spacing</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span>
<span class="p">{</span>
   <span class="n">KEEP</span><span class="p">(</span><span class="o">*</span><span class="p">(.</span><span class="n">vector_1</span><span class="p">))</span>
<span class="p">}</span> <span class="o">&gt;</span> <span class="n">kseg0_program_mem</span>
<span class="n">ASSERT</span> <span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">SIZEOF</span><span class="p">(.</span><span class="n">vector_1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">_vector_spacing</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="s">"function at exception vector 1 too large"</span><span class="p">)</span>
<span class="p">...</span>
<span class="p">...</span>

</code></pre></div></div> <h3 id="note"> <a href="#note" aria-labelledby="note" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Note </h3> <ul> <li> <p><strong>The bootloader and the application must have the same device configuration bit settings. The Device configuration bit settings from the bootloader project will be updated by the programmer/debugger, Hence the application linker script should not have any device configuration bit settings. The application project will use the device configuration bit settings done by bootloader.</strong></p> </li> <li> <p><strong>Device configurations and debug exception need to discarded from final hex file for the application project.</strong></p> </li> </ul> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="n">DISCARD</span><span class="o">/</span> <span class="o">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">_debug_exception</span><span class="p">)</span> <span class="p">}</span>
<span class="o">/</span><span class="n">DISCARD</span><span class="o">/</span> <span class="o">:</span> <span class="p">{</span> <span class="o">*</span><span class="p">(.</span><span class="n">config_</span><span class="o">*</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div> <h2 id="additional-settings-optional"> <a href="#additional-settings-optional" aria-labelledby="additional-settings-optional" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional settings (Optional) </h2> <ul> <li><strong>Data Memory Origin</strong> and <strong>Data Memory Length</strong> values should be updated in linkerscript for reserving configured bytes from start of RAM to <strong>trigger bootloader from firmware</strong></li> </ul> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Reserve &lt;trigger_len&gt; Bytes to Store Bootloader Trigger Pattern */</span>
<span class="n">kseg0_data_mem</span>       <span class="p">(</span><span class="n">w</span><span class="o">!</span><span class="n">x</span><span class="p">)</span>  <span class="o">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ram_start</span><span class="o">&gt;</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">trigger_len</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">ram_length</span><span class="o">&gt;</span> <span class="o">-</span> <span class="o">&lt;</span><span class="n">trigger_len</span><span class="o">&gt;</span>
</code></pre></div></div> <h2 id="mplab-x-settings"> <a href="#mplab-x-settings" aria-labelledby="mplab-x-settings" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MPLAB X Settings </h2> <ul> <li> <p>Specifying post build option to automatically generate the binary file from hex file once the build is complete</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${MP_CC_DIR}/xc32-objcopy -I ihex -O binary ${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.hex ${DISTDIR}/${PROJECTNAME}.${IMAGE_TYPE}.bin
</code></pre></div> </div> <p align="center"> <img src="./images/application_config_post_build_script.png" /> </p> </li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
